---
title: jvm初识
date: 2020-05-11 14:18:17
tags:
  - jvm
categories: java
---

jvm大致结构与作用

<!--more-->

jvm 内存区域划分
jvm虚拟机数据区域 ：1.程序计数区 2.java虚拟机栈 3.本地方法栈 4.堆 5.方法区
本地内存：1.元数据区 2.直接内存
jvm内存大小一般具有默认值，也可以手动设置

程序计数器
程序计数器（Program Counter Register）是一块较小的内存空间，它的作用可以看做是当前线程所执行的字节码的行号指示器。在虚拟机的概念模型里（仅是概念模型，各种虚拟机可能会通过一些更高效的方式去实现）， 字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个计数器来完成。
由于Java 虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，在任何一个确定的时刻 ，一个处理器（对于多核处理器来说是一个内核）只会执行一条线程中的指令。因此，为了线程切换后能恢复到 正确的执行位置，每条线程都需要有一个独立的程序计数器，各条线程之间的计数器互不影响，独立存储，我们称这类内存区域为“线程私有”的内存。
如果线程正在执行的是一个Java 方法，这个计数器记录的是正在执行的虚拟机字节码指令的地址；如果正在执 行的是Natvie 方法，这个计数器值则为空（Undefined）。此内存区域是唯一一个在Java 虚拟机规范中没有规 定任何OutOfMemoryError 情况的区域。

栈
里面存放：
1.局部变量，对象引用,returnAddress
2.操作数栈
3.动态链接
4.方法出口信息 （最常见，无限递归，抛出栈溢出）
抛异常后，将会释放掉 | 可以在任务管理器，内存中查看是否变高。

本地方法栈
本地方法栈（Native Method Stacks）与虚拟机栈所发挥的作用是非常相似的，其区别不过是虚拟机栈为虚拟机 执行Java 方法（也就是字节码）服务，而本地方法栈则是为虚拟机使用到的Native方法服务。

堆
JVM内存占用最大，管理最复杂的一个区域。唯一的途径就是存放对象实例：所有的对象实例以及数组都在堆上 进行分配。
最常见-线下单独开发，一个定时任务，运行没有问题，上线后，同事也有定时任务，当一起启动时，堆中内存 ，不足，就会抱出，堆溢出。
所以往往，堆需要，不管的调式，测试，取到一个合适的阀值。

方法区
方法区在一个JVM 实例的内部，类型信息被存储在一个称为方法区的内存逻辑区中。类型信息是由类加载器在类加载时从类文件中提取出来的。类(静态)变量也存储在方法区中。 简单说方法区用来存储类型的元数据信息，一个.class文件是类被java虚拟机使用之前的表现形式，一旦这个类要被使用，java虚拟机就会对其进行装载、连接（验证、准备、解析）和初始化，而装载后的结果就是由.class文件转变为方法区中的一段特定的数据结构。
存放类信息、类的静态变量、常量、运行时常量池等，方法区的大小是可以动态扩展的